<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sniper Pro | Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0b0e11; color: #c9d1d9; }
        .card { background: #161b22; border: 1px solid #30363d; border-radius: 12px; }
        .status-ready { color: #2ea043; background: rgba(46, 160, 67, 0.15); border: 1px solid rgba(46, 160, 67, 0.4); }
        .status-watch { color: #58a6ff; background: rgba(88, 166, 255, 0.15); border: 1px solid rgba(88, 166, 255, 0.4); }
        .expanded-row { background-color: #1c2128; border-top: 1px dashed #30363d; }
        .hidden-row { display: none; }
        .animate-fade { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="p-4 md:p-8 max-w-7xl mx-auto">

    <header class="flex justify-between items-end mb-8 border-b border-gray-800 pb-4">
        <div>
            <h1 class="text-3xl font-extrabold text-white tracking-tight"><i class="fa-solid fa-crosshairs text-red-500 mr-2"></i>Turnaround Sniper</h1>
            <p class="text-gray-500 text-sm mt-1">AI-Powered Contrarian Strategy</p>
        </div>
        <div class="text-right">
            <div id="last-update" class="text-xs font-mono text-gray-500">WAITING FOR DATA...</div>
            <div class="text-xs text-blue-400 mt-1"><i class="fa-solid fa-server mr-1"></i>Server Active</div>
        </div>
    </header>

    <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="card p-5 border-l-4 border-l-green-500">
            <h3 class="text-gray-400 text-xs font-bold uppercase mb-1">Top Opportunity</h3>
            <div id="top-pick-ticker" class="text-2xl font-bold text-white">-</div>
            <div id="top-pick-desc" class="text-sm text-gray-500 mt-2">ë¶„ì„ ì¤‘...</div>
        </div>
        <div class="card p-5">
            <h3 class="text-gray-400 text-xs font-bold uppercase mb-1">Market Sentiment</h3>
            <div class="flex items-center mt-2">
                <div class="w-full bg-gray-700 h-2 rounded-full mr-2">
                    <div id="market-bar" class="bg-blue-500 h-2 rounded-full" style="width: 50%"></div>
                </div>
                <span id="market-score" class="text-xs text-white">Neutral</span>
            </div>
            <p class="text-xs text-gray-500 mt-2">ì „ì²´ í›„ë³´êµ°ì˜ ë‰´ìŠ¤ ê°ì • í‰ê· </p>
        </div>
        <div class="card p-5">
            <h3 class="text-gray-400 text-xs font-bold uppercase mb-1">Scan Stats</h3>
            <div class="flex justify-between items-center mt-2">
                <div class="text-center">
                    <span class="block text-xl font-bold text-white" id="stat-total">-</span>
                    <span class="text-[10px] text-gray-500">Scanned</span>
                </div>
                <div class="text-gray-700">â†’</div>
                <div class="text-center">
                    <span class="block text-xl font-bold text-green-400" id="stat-ready">-</span>
                    <span class="text-[10px] text-gray-500">Found</span>
                </div>
            </div>
        </div>
    </section>

    <main>
        <div class="flex items-center space-x-2 mb-4">
            <i class="fa-solid fa-list text-gray-500"></i>
            <h3 class="text-lg font-bold text-white">Operational Candidates</h3>
            <span class="text-xs text-gray-600 bg-gray-800 px-2 py-0.5 rounded ml-2">Click rows for details</span>
        </div>

        <div class="overflow-hidden rounded-xl border border-gray-800">
            <table class="w-full text-left border-collapse bg-[#0d1117]">
                <tbody id="candidate-body" class="divide-y divide-gray-800">
                    </tbody>
            </table>
        </div>
    </main>

    <script>
        async function loadDashboard() {
            try {
                const response = await fetch('data/data.json?t=' + Date.now());
                const data = await response.json();

                // 1. ìƒë‹¨ ë¸Œë¦¬í•‘ ì—…ë°ì´íŠ¸
                document.getElementById('last-update').innerText = `UPDATED: ${data.metadata.generated_at}`;
                document.getElementById('stat-total').innerText = (data.metadata.pipeline_stats.universe || 5000).toLocaleString();
                const readyCount = data.candidates.filter(c => c.evidence.s4_tag === 'READY').length;
                document.getElementById('stat-ready').innerText = readyCount;

                // Top Pick ì„ ì • (Ready ì¤‘ ë°˜ë“±í­ì´ ê°€ì¥ í° ë†ˆ)
                const topPick = data.candidates.find(c => c.evidence.s4_tag === 'READY') || data.candidates[0];
                if (topPick) {
                    document.getElementById('top-pick-ticker').innerText = `${topPick.ticker} ($${topPick.price})`;
                    document.getElementById('top-pick-desc').innerText = `ë‚™í­ ${(topPick.metrics.drop_rate * 100).toFixed(1)}%ì—ì„œ ê°•í•œ ë°˜ë“± ì‹ í˜¸ í¬ì°©.`;
                }

                // 2. ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
                const body = document.getElementById('candidate-body');
                body.innerHTML = '';

                data.candidates.forEach((stock, index) => {
                    const isReady = stock.evidence.s4_tag === 'READY';
                    const tagClass = isReady ? 'status-ready' : 'status-watch';
                    const drop = stock.metrics.drop_rate.toFixed(1);
                    const rec = (stock.metrics.rec_rate * 100).toFixed(1);
                    
                    // ë‰´ìŠ¤ ë° í•´ì„ ìƒì„± (ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’)
                    const newsTitle = stock.context || "Analyzing market data...";
                    // í•´ì„ë³¸ì€ ë‚˜ì¤‘ì— Module Dì—ì„œ ìƒì„±í•´ì„œ ë„£ì–´ì¤„ ìˆ˜ ìˆìŒ. ì§€ê¸ˆì€ ê°€ì§œ ë°ì´í„° ì˜ˆì‹œ
                    const interpretation = isReady 
                        ? "ì´ ì¢…ëª©ì€ ê³¼ë§¤ë„ êµ¬ê°„ì—ì„œ ìœ ì˜ë¯¸í•œ ìˆ˜ê¸‰ì´ ë“¤ì–´ì˜¤ë©° ë°˜ë“±ì„ ì‹œë„í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì•…ì¬ê°€ í•´ì†Œë˜ëŠ” êµ­ë©´ì¸ì§€ ë‰´ìŠ¤ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."
                        : "ì•„ì§ í•˜ë½ì„¸ê°€ ë©ˆì·„ë‹¤ê³  í™•ì‹ í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤. ê´€ë§ì´ í•„ìš”í•©ë‹ˆë‹¤.";

                    // Row 1: ìš”ì•½í–‰
                    const summaryRow = `
                        <tr class="cursor-pointer hover:bg-gray-800/50 transition-colors" onclick="toggleRow(${index})">
                            <td class="p-4 w-24">
                                <div class="text-xl font-bold text-white">${stock.ticker}</div>
                            </td>
                            <td class="p-4 w-32">
                                <div class="text-sm font-mono text-gray-300">$${stock.price}</div>
                                <div class="text-xs ${stock.metrics.rec_rate > 0 ? 'text-red-400' : 'text-green-400'}">
                                    ${drop}% â†“
                                </div>
                            </td>
                            <td class="p-4 hidden md:table-cell">
                                <div class="text-sm text-gray-400 line-clamp-1">${newsTitle}</div>
                            </td>
                            <td class="p-4 text-right">
                                <span class="px-3 py-1 rounded text-xs font-bold ${tagClass}">${stock.evidence.s4_tag}</span>
                                <i class="fa-solid fa-chevron-down text-gray-600 ml-2 text-xs"></i>
                            </td>
                        </tr>
                    `;

                    // Row 2: ìƒì„¸í–‰ (ìˆ¨ê²¨ì§)
                    const detailRow = `
                        <tr id="detail-${index}" class="hidden-row expanded-row bg-[#12161c]">
                            <td colspan="4" class="p-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <h4 class="text-xs font-bold text-gray-500 uppercase mb-2">ğŸ“Š AI Strategy Analysis</h4>
                                        <p class="text-sm text-gray-300 leading-relaxed mb-4">
                                            <span class="text-blue-400 font-bold">íŒë‹¨ ê·¼ê±°:</span> ${interpretation}
                                        </p>
                                        <div class="flex space-x-4 text-xs font-mono text-gray-500">
                                            <div>Recovery: <span class="text-green-400">+${rec}%</span></div>
                                            <div>Market Cap: <span class="text-white">Large Cap</span></div>
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="text-xs font-bold text-gray-500 uppercase mb-2">ğŸ“° News Context</h4>
                                        <div class="p-3 bg-black/30 rounded border border-gray-800 text-sm text-gray-400">
                                            ${newsTitle}
                                            <a href="https://www.google.com/search?q=${stock.ticker}+stock+news" target="_blank" class="block mt-2 text-blue-500 hover:underline text-xs">
                                                <i class="fa-brands fa-google mr-1"></i> Read full stories
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    `;

                    body.insertAdjacentHTML('beforeend', summaryRow + detailRow);
                });

            } catch (err) {
                console.error(err);
            }
        }

        function toggleRow(index) {
            const row = document.getElementById(`detail-${index}`);
            row.classList.toggle('hidden-row');
            row.classList.toggle('animate-fade');
        }

        loadDashboard();
    </script>
</body>
</html>
